const { ApplicationCommandOptionType, EmbedBuilder, PermissionFlagsBits, } = require("discord.js");

module.exports = {
    name: 'clear',
    description: 'Löscht eine gewisse Anzahl im Channel!',
    options: [
        {
            name: 'anzahl',
            description: 'Wie viel Nachrichten sollen gelöscht werden?',
            type: ApplicationCommandOptionType.Integer,
            required: true,
        },
        {
            name: 'benutzer',
            description: 'Um nachrichten von einem bestimmten User zu löschen',
            type: ApplicationCommandOptionType.Mentionable,
            required: false,
        },
    ],
    
    callback: async (interaction) => {
        const { channel, options } = interaction;

        const anzahl = options.getInteger('anzahl');
        const benutzer = options.getUser('benutzer');

        const messages = await channel.messages.fetch({
            limit: anzahl + 1,
        });

        const res = new EmbedBuilder()
            .setColor(0x5fb041);

        if (benutzer) {
            let i = 0;
            const filtered = [];

            messages.filter((msg) => {
                if (msg.author.id === benutzer.id && i < anzahl) {
                    filtered.push(msg);
                    i++;
                }
            });

            await channel.bulkDelete(filtered).then((deletedMessages) => {
                res.setDescription(`Erfolgreich ${deletedMessages.size} Nachrichten von ${benutzer} gelöscht.`);
                interaction.reply({ embeds: [res] });
            });
        } else {
            await channel.bulkDelete(anzahl, true).then((deletedMessages) => {
                res.setDescription(`Erfolgreich ${deletedMessages.size} Nachrichten gelöscht.`);
                interaction.reply({ embeds: [res] });
            });
        }
    }
};



  //   let response = await interaction.reply({ embeds: [new EmbedBuilder().setDescription(`Erfolgreich dein Ticket erstellt!\n Ticket: ${ticketChannel}`).setColor('#57F287')], ephemeral: true });
  // /*  const staffRole = guild.roles.cache.get('1169715609878138995'); // Füge die ID der Mitarbeiterrolle ein
  //   if (staffRole) {
  //     await ticketChannel.send(`${staffRole.toString()}, neues Ticket von ${interaction.user.tag}`);
  //   }  */